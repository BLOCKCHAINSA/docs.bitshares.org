



<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>}</title>

    <!-- CSS -->
    <link  href='../_static/main.css' rel='stylesheet'>
    <link  href='../_static/style.css' rel='stylesheet'>
    <link  href='../_static/doxygen.css' rel='stylesheet'>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    <!-- Sphinx search -->
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <!-- Transifex -->
    <script type="text/javascript">
      window.liveSettings = {
        api_key: "bbf87af0641e4bbf89c98088d48e0449",
      };
    </script>
    <script type="text/javascript" src="http://cdn.transifex.com/live.js"></script>

    <!-- title card -->
    <link  href='../_static/title-card.css' rel='stylesheet'>
    <script src='../_static/script.js'></script>
    
    <!-- Sphinx search -->
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Graphene/BitShares 2.0 Technical Documentation  documentation"
          href="../_static/opensearch.xml"/>

    <!-- Meta -->
    <meta content="Graphene Documentation" property="og:site_name">
    <meta content="Graphene Documentation" property="og:title">
    <meta content="website" property="og:type">
    <meta content="Graphene Documentation" name="description">
    <meta content="Graphene Documentation" property="og:description">
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68381245-1', 'auto');
  ga('send', 'pageview');

</script>

 </head>
 <body class='no-literate'>


 <div class='title-area title-card' style='background-image: url(https://bitshares.org/images/bg.jpg)'>
   <div class='in'>
     <div class='headline'>
       <h1>}</h1>
 
     </div>
   </div>
 </div>

 <div class='header'>
   <div class='left navlinks'>
    
        <div class="top">
         <div class="title">top</div>
         <span><a class="uplink" href="../index.html">Contents</a></span>
        </div>

   </div>
   <!--
    <div class='right'>
<div id="searchbox" style="display: none" role="search">
 <form class="search" action="../search.html" method="get">
   <input type="text" name="q" />
   <input type="submit" value="Go" />
   <input type="hidden" name="check_keywords" value="yes" />
   <input type="hidden" name="area" value="default" />
 </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
   </div>
   -->
 </div>

 <div class='content-root'>
  <!-- menu bar -->
  <div class='menubar'>
   <div class='section'>
    <a href="../"><img src="../_static/grphn-logo.svg" width="48" /></a>
       <!--<a class='big button' href='#' target='_blank'>Download</a>-->
   </div>
   <div class='menu section'>
    <div id="toc">
      <h3>Table Of Contents</h3>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../migration/index.html">Migrating from BitShares 1.0 to BitShares 2.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../integration/index.html">Integrating the BitShares Network</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apps/index.html">Applications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../blockchain/index.html">Blockchain Specifications</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Graphene API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/index.html">Namespaces</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testnet/index.html">Testnets</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../meta/index.html">Meta</a></li>
</ul>

    </div>
   </div>
   <div class='bottom section'>
   <!--
     <a href='https://github.com/cryptonomex/graphene'>View on GitHub</a><br>
     <a href='https://github.com/cryptonomex/graphene/blob/master/README.md' target='_blank'>See .md source</a>
   -->
   </div>
  </div>
  <div class='content'>
   
  <p>## Wallet Login Protocol</p>
<p>The idea behind the login protocol is to allow another party to verify that you are are the owner of a particular account.  Traditionally login is performed via a password that sent to the server, but this method is subject to [Phishing Attacks](<a class="reference external" href="https://en.wikipedia.org/wiki/Phishing">https://en.wikipedia.org/wiki/Phishing</a>).  Instead of a password, Graphene uses a cryptographic challenge/response to verify that a user controls a particular account.</p>
<p>For the purpose of this document, we will assume <a class="reference external" href="https://merchant.org">https://merchant.org</a> is the service that will be logged into and that <a class="reference external" href="https://wallet.org">https://wallet.org</a> is the wallet provider that will be assisting the user with their login.</p>
<p>## Step 1 - Merchant Login Button</p>
<p>The merchant must provide the user with a login button that links to <a class="reference external" href="https://wallet.org">https://wallet.org</a>/login#${args} where ${args} is a JSON object serialized with the [Wallet Argument Format](Wallet Argument Format) and containing following information:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>`
{</p>
<blockquote>
<div>&#8220;onetimekey&#8221; : &#8220;${SERVER_PUBLIC_KEY}&#8221;,
&#8220;account&#8221;  : &#8220;${OPT_ACCOUNT_NAME}&#8221;,
&#8220;callback&#8221; : &#8220;<a class="reference external" href="https://merchant.org/login_callback">https://merchant.org/login_callback</a>&#8220;</div></blockquote>
<div class="section" id="id3">
<h1>}<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h1>
<p>The merchant server will need to save the <cite>${SERVER_PRIVATE_KEY}</cite> associated with the <cite>${SERVER_PUBLIC_KEY}</cite> in the user&#8217;s web session in order to verify the login.</p>
<p>## Step 2 - Wallet Confirmation</p>
<p>When the user loads <cite>https://wallet.org/login#${args}</cite> they will be prompted to confirm the login request by selecting an account that they wish to login with.  If &#8220;account&#8221; was specified in the <cite>${args}</cite> then it will default to that account.</p>
<p>After the account is identified enough keys to authorize a account must participate in the login process in the following way.</p>
<p>The wallet generates a <cite>WALLET_ONETIMEKEY</cite> and derives a <cite>shared secret</cite> with the <cite>SERVER_PUBLIC_KEY</cite> provided by the <a class="reference external" href="https://merchant.org">https://merchant.org</a> via <cite>${args}</cite>.   This shared secret is a provably &#8220;random&#8221; 512 bits of data that is only known to the wallet at this point in time.   The wallet then gathers signatures on the shared secret from enough keys to authorize the account.  In the simple case this will be a single signature, but in more complex cases multi-factor authentication may be required.</p>
<p>After gathering all of the signatures the wallet redirects the user to <cite>https://merchant.org/login_callback?a=${result}</cite> where <cite>result</cite> is an encoded JSON object containing the following information:</p>
<p><a href="#id4"><span class="problematic" id="id5">``</span></a>`
{</p>
<blockquote>
<div>&#8220;account&#8221;: &#8220;Graphene Account Name&#8221;,
&#8220;server_key&#8221;: &#8220;${SERVER_PUBLIC_KEY}&#8221;,
&#8220;account_key&#8221;: &#8220;${WALLET_ONETIMEKEY}&#8221;,
&#8220;signatures&#8221; : [ &#8220;SIG1&#8221;, &#8220;SIG2&#8221;, .. ]</div></blockquote>
</div>
<div class="section" id="id6">
<h1>}<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h1>
<p>## Step 3 - Server Verifies Authority</p>
<p>Upon receiving the <cite>result</cite> from the wallet, <a class="reference external" href="https://merchant.org">https://merchant.org</a> will lookup ${SERVER_PRIVATE_KEY} in the user&#8217;s session data and then combine it with <cite>${WALLET_ONETIMEKEY}</cite> to generate the <cite>shared secret</cite> that was used by the wallet.   Once this shared secret has been recovered, it can be used to recover the public keys that correspond to the provided signatures.</p>
<p>The last step is to verify that the public keys provided by the signatures are sufficient to authorize the account given the current state of the graphene blockchain.   This can be achieved using the witness API call <cite>verify_account_authority( account_name_or_id, [public_keys...] )</cite>.   The <cite>verify_account_authority</cite> call will return <cite>true</cite> if the provided keys have sufficient authority to authorize the account, otherwise it will return <cite>false</cite></p>
</div>


  </div>
 </div>

 <script>var HN=[];HN.factory=function(e){return function(){HN.push([e].concat(Array.prototype.slice.call(arguments,0)))};},HN.on=HN.factory("on"),HN.once=HN.factory("once"),HN.off=HN.factory("off"),HN.emit=HN.factory("emit"),HN.load=function(){var e="hn-button.js";if(document.getElementById(e))return;var t=document.createElement("script");t.id=e,t.src="//hn-button.herokuapp.com/hn-button.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)},HN.load();</script>
 </body>
</html>