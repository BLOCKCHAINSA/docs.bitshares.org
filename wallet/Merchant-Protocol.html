



<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>}</title>

    <!-- CSS -->
    <link  href='../_static/main.css' rel='stylesheet'>
    <link  href='../_static/style.css' rel='stylesheet'>
    <link  href='../_static/doxygen.css' rel='stylesheet'>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

    <!-- Sphinx search -->
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script src='../_static/script.js'></script>

    <!-- title card -->
    <link  href='../_static/title-card.css' rel='stylesheet'>
    <script src='../_static/title-card.js'></script>
    
    <!-- Sphinx search -->
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Graphene/BitShares 2.0 Technical Documentation  documentation"
          href="../_static/opensearch.xml"/>

    <!-- Meta -->
    <meta content="Graphene Documentation" property="og:site_name">
    <meta content="Graphene Documentation" property="og:title">
    <meta content="website" property="og:type">
    <meta content="Graphene Documentation" name="description">
    <meta content="Graphene Documentation" property="og:description">
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68381245-1', 'auto');
  ga('send', 'pageview');

</script>

 </head>
 <body class='no-literate'>

 <div class='title-area title-card' style='background-image: url(https://bitshares.org/images/bg.jpg)'>
   <div class='in'>
     <div class='headline'>
       <h1>Graphene/BitShares 2.0 Technical Documentation</h1>
       <p>}</p>
       <p style="margin-top: 3em;"><img src="../_static/learn.svg" width="124" /><p>
     </div>
   </div>
 </div>

 <div class='header'>
   <div class='left'>
    
        <a class="uplink" href="../index.html">Contents</a>

   </div>
 </div>

 <div class='content-root'>
  <!-- menu bar -->
  <div class='menubar'>
   <div class='section'>
    <img src="../_static/grphn-logo.svg" width="48" />
       <!--<a class='big button' href='#' target='_blank'>Download</a>-->
   </div>
   <div class='menu section'>
    <div id="toc">
      <h3>Table Of Contents</h3>
      <ul>
<li><a class="reference internal" href="#">}</a></li>
</ul>

    </div>
   </div>
   <div class='bottom section'>
   <!--
     <a href='https://github.com/cryptonomex/graphene'>View on GitHub</a><br>
     <a href='https://github.com/cryptonomex/graphene/blob/master/README.md' target='_blank'>See .md source</a>
   -->
   </div>
  </div>
  <div class='content'>
   
  <p># Wallet Merchant Protocol</p>
<p>The purpose of this protocol is to enable a merchant to request payment from the user via a hosted wallet provider or via a browser plugin.  We will assume that the wallet is hosted at <a class="reference external" href="https://wallet.org">https://wallet.org</a> and that the merchant is hosted at <a class="reference external" href="https://merchant.org">https://merchant.org</a>.</p>
<p># Privacy Concerns</p>
<p>The goal of this protocol is to maintain user and merchant privacy from the wallet provider which should never have direct access to the invoice data.</p>
<p>To securely pass data from <a class="reference external" href="https://merchant.org">https://merchant.org</a> to the javascript wallet hosted at <a class="reference external" href="https://wallet.org">https://wallet.org</a>, the data will have to be passed after the &#8220;#&#8221;.  Assuming the wallet provider is not serving up pages designed to compromise your privacy, only your web browser will have access to the invoice data.</p>
<p>## Step 1: Define your Invoice via JSON</p>
<p>This invoice provides all of the data needed by the wallet to display an invoice to the user.</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>`
{</p>
<blockquote>
<div><p>&#8220;to&#8221; : &#8220;merchant_account_name&#8221;,
&#8220;to_label&#8221; : &#8220;Merchant Name&#8221;,
&#8220;memo&#8221; : &#8220;Invoice #1234&#8221;,
&#8220;line_items&#8221; : [</p>
<blockquote>
<div><blockquote>
<div>{ &#8220;label&#8221; : &#8220;Something to Buy&#8221;, &#8220;quantity&#8221;: 1, &#8220;price&#8221; : &#8220;1000.00 SYMBOL&#8221; },
{ &#8220;label&#8221; : &#8220;10 things to Buy&#8221;, &#8220;quantity&#8221;: 10, &#8220;price&#8221; : &#8220;1000.00 SYMBOL&#8221; },
{ &#8220;label&#8221; : &#8220;User Specified Price&#8221;, &#8220;quantity&#8221;: 1, &#8220;price&#8221; : &#8220;CUSTOM SYMBOL&#8221; },
{ &#8220;label&#8221; : &#8220;User Asset and Price&#8221;, &#8220;quantity&#8221;: 1, &#8220;price&#8221; : &#8220;CUSTOM&#8221; }</div></blockquote>
<p>],
&#8220;note&#8221; : &#8220;Something the merchant wants to say to the user&#8221;,
&#8220;callback&#8221; : &#8220;<a class="reference external" href="https://merchant.org/complete">https://merchant.org/complete</a>&#8220;</p>
</div></blockquote>
</div></blockquote>
<div class="section" id="id3">
<h1>}<a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h1>
<blockquote>
<div>By itself this data is 579 characters which after URL encoding is 916 characters, with a 2000 character limit this approach doesn&#8217;t scale as well as we would like.</div></blockquote>
<p>## Step 2: Compress your JSON representation</p>
<p>Using [LZMA-JS](<a class="reference external" href="https://github.com/nmrugg/LZMA-JS/">https://github.com/nmrugg/LZMA-JS/</a>) library to compress the JSON into a binary array.  This will be the most compact form of the data.  After running the compression the example JSON was reduced to 281 bytes from 579 bytes.</p>
<p>## Step 3: Convert to Base58</p>
<p>Using the [bs58](<a class="reference external" href="http://cryptocoinjs.com/modules/misc/bs58/">http://cryptocoinjs.com/modules/misc/bs58/</a>) library encode the compressed data in base58.  Base58 is URL friendly and size efficient.  After converting to base58 the string will be 385 characters which can easily be passed in a URL and easily support much larger invoices.</p>
<p>## Step 4: Pass to Wallet</p>
<p>Once the Base58 data is known, it can be passed to the wallet with the following URL:</p>
<p><a class="reference external" href="https://wallet.org/#/invoice/BASE58BLOB">https://wallet.org/#/invoice/BASE58BLOB</a></p>
<p>## Step 5: Receive Callback from Wallet</p>
<p>After the wallet has signed a transaction, broadcast it, and gotten confirmation from <a class="reference external" href="https://wallet.org">https://wallet.org</a> that the transaction was included in <cite>block 12345</cite> as <cite>transaction 4</cite> wallet will direct the user to <cite>https://merchant.org/complete?block=12345&amp;trx=4</cite></p>
<p>The merchant will then request that transaction from <a class="reference external" href="https://wallet.org/api?block=12345&amp;trx=4">https://wallet.org/api?block=12345&amp;trx=4</a> which will respond with the transaction that was included in the blockchain.   The merchant will decrypt the memo from the transaction and use memo content to confirm payment for the invoice.</p>
<p>## Step 6: Payment Complete</p>
<p>At this point the user has successfully made a payment and the merchant has verified the payment has been received without having to maintain a full node.</p>
</div>


  </div>
 </div>

 <script>var HN=[];HN.factory=function(e){return function(){HN.push([e].concat(Array.prototype.slice.call(arguments,0)))};},HN.on=HN.factory("on"),HN.once=HN.factory("once"),HN.off=HN.factory("off"),HN.emit=HN.factory("emit"),HN.load=function(){var e="hn-button.js";if(document.getElementById(e))return;var t=document.createElement("script");t.id=e,t.src="//hn-button.herokuapp.com/hn-button.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)},HN.load();</script>
 </body>
</html>